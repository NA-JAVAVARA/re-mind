<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="replyMapper">

	<resultMap type="Reply" id="reply_rm">
		<id property="replyNo" column="REPLY_NO"/>

		<result property="replyContent" column="REPLY_CONTENT"/>
		<result property="replyCreateDate" column="REPLY_CREATE_DT"/>
		<result property="replyModifyDate" column="REPLY_MODIFY_DT"/>
		<result property="replyStatusCode" column="REPLY_STATUS_CD"/>
		<result property="replyNestedCode" column="REPLY_NESTED_CD"/>

		<result property="boardNo" column="REPLY_NO"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="professionNo" column="PROFESSION_NO"/>
		<result property="parentReplyNo" column="REPLY_NESTED_CD"/>

		<result property="boardTitle" column="BOARD_TITLE"/>
		<result property="readCount" column="BOARD_READ_COUNT"/>
		<result property="boardCategoryName" column="BOARD_CATEGORY_NM"/>
		<result property="memberFn" column="MEMBER_FN"/>

	</resultMap>

	<select id="selectMyReplyList" resultMap="reply_rm">
		SELECT REPLY.REPLY_NO, BOARD_TITLE,
			   TO_CHAR(REPLY_CREATE_DT, 'YYYY-MM-DD') "REPLY_CREATE_DT" ,
			   BOARD_CATEGORY_NM, MEMBER.MEMBER_FN, REPLY.MEMBER_NO, BOARD.BOARD_NO, BOARD_READ_COUNT,
			   POST_NO, REPLY_NESTED_CD
		FROM REPLY
				 JOIN BOARD ON (BOARD.BOARD_NO = REPLY.BOARD_NO)
				 JOIN BOARD_CATEGORY USING(BOARD_CATEGORY_CD)
				 JOIN MEMBER ON (MEMBER.MEMBER_NO = REPLY.MEMBER_NO)
				 LEFT JOIN MIND_POST ON( MEMBER.MEMBER_NO = MIND_POST.MEMBER_NO)
		WHERE REPLY.MEMBER_NO = #{memberNo}
		  AND BOARD.BOARD_STATUS_CD = 201
		  AND STATUS_CD = 0
		  AND REPLY_STATUS_CD = 301
		ORDER BY REPLY_NO DESC
	</select>
	
	<!-- 댓글 목록 조회 -->
	<select id="selectList" resultMap="reply_rm">
	SELECT LEVEL, R.*
	FROM (SELECT REPLY_NO, REPLY_CONTENT,
	     TO_CHAR(REPLY_CREATE_DT, 'YYYY"년" MM"월" DD"일" HH24"시" MI"분" SS"초"') REPLY_CREATE_DT,
	     BOARD_NO, REPLY_STATUS_CD, PARENT_REPLY_NO, MEMBER_NO, MEMBER_FN
	   	 FROM REPLY
	     JOIN MEMBER USING(MEMBER_NO)
	     WHERE BOARD_NO = #{boardNo}
	     AND REPLY_STATUS_CD=301) R
	START WITH PARENT_REPLY_NO IS NULL
	CONNECT BY PRIOR REPLY_NO = PARENT_REPLY_NO
	ORDER SIBLINGS BY REPLY_NO
	</select>


</mapper>
