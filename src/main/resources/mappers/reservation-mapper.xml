<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="reservationMapper">
	
	<!-- 결제예약결제 vo -->
	<resultMap type="ReservationPayMent" id="reservationPayMent_rm">
		<id property="reservationPayNo" column="RESERVATION_PAY_NO"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="professionNo" column="PROFESSION_NO"/>
		<result property="totalCnt" column="TOTAL_CNT"/>
		<result property="usedCnt" column="USED_CNT"/>
		<result property="statusCode" column="STATUS_CD"/>
	</resultMap>
	
	<!-- 결제 vo -->
	<resultMap type="Payment" id="Payment_rm">
		<id property="payNo" column="PAY_NO"/>
		<result property="payAmount" column="PAY_AMOUNT"/>
		<result property="payDate" column="PAY_DT"/>
		<result property="payUpdateDate" column="PAY_UPDATE_DT"/>
		<result property="paymentStatus" column="PAYMENT_STATUS"/>
		<result property="reservationNo" column="RESERVATION_NO"/>
	</resultMap>
	
	<!-- 상담예약 vo -->
	<resultMap type="Reservation" id="Reservation_rm">
		<id property="reservationNo" column="RESERVATION_NO"/>
		<result property="reservationEnrollDate" column="RESERVATION_ENROLL_DT"/>
		<result property="reservationEnrollTime" column="RESERVATION_ENROLL_TIME"/>
		<result property="reservationStatusCode" column="RESERVATION_STATUS_CD"/>
		<result property="reservationCancel" column="RESERVATION_CANCEL"/>
		<result property="counselCategoryNo" column="COUNSEL_CATEGORY_NO"/>
		<result property="reservationPayNo" column="RESERVATION_PAY_NO"/>
	</resultMap>
	
	<!-- 상담예약결제 insert -->
	<insert id="reservationPaymentInsert" useGeneratedKeys="true">
	
		<selectKey order="BEFORE" resultType="_int" keyProperty="reservationPayNo">
			SELECT SEQ_RESERVATION_PAYMENT_NO.NEXTVAL FROM DUAL
		</selectKey>

		INSERT INTO RESERVATION_PAYMENT 
		VALUES(#{reservationPayNo},3,24,#{totalCnt},DEFAULT,DEFAULT)
		
	</insert>
	
	<!-- 결제 tb에 총금액 상담 예약결제번호 insert -->
	<insert id="paymentInsert" useGeneratedKeys="true">
	
		<selectKey order="BEFORE" resultType="_int" keyProperty="payNo">
			SELECT SEQ_PAY_NO.NEXTVAL FROM DUAL
		</selectKey>

		INSERT INTO PAYMENT
		VALUES(#{payNo},#{payAmount},NULL,NULL,NULL,#{reservationNo})
	</insert>
	
	<!-- 총 금액 select -->
	<select id="priceSelect" resultType="_int">
		SELECT PAY_AMOUNT FROM PAYMENT WHERE PAY_NO = #{payNo}
	</select>
	
	<!-- payment update -->
	<update id="paymentUpdate">
		UPDATE PAYMENT SET
		PAY_DT = SYSDATE,
		PAYMENT_STATUS = 1
		WHERE PAY_NO = #{payNo}
	</update>
	
	<!-- reservation insert -->
	<insert id="reservationInsert">
		<![CDATA[
			INSERT INTO RESERVATION
			VALUES(SEQ_RESERVATION_NO.NEXTVAL,#{reservationEnrollDate},#{reservationEnrollTime},1,NULL,
			(SELECT COUNSEL_CATEGORY_NO FROM COUNSEL_CATEGORY WHERE COUNSEL_CATEGORY_NM = #{counselCategoryNm}),
			(SELECT RESERVATION_NO FROM PAYMENT WHERE PAY_NO = #{payNo}))
		]]>
	</insert>
	
</mapper>
