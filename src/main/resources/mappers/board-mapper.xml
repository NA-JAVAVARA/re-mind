<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">

	<resultMap type="Board" id="board_rm">
		<id property="boardNo" column="BOARD_NO"/>

		<result property="boardTitle" column="BOARD_TITLE"/>
		<result property="boardContent" column="BOARD_CONTENT"/>
		<result property="createDate" column="BOARD_CREATE_DT"/>
		<result property="modifyDate" column="BOARD_MODIFY_DT"/>
		<result property="replyCheckCode" column="REPLY_CHECK_CD"/>
		<result property="scrapCheckCode" column="SCRAP_CHECK_CD"/>
		<result property="anonCheckCode" column="ANON_CHECK_CD"/>
		<result property="empathyCheckCode" column="EM_CHECK_CD"/>
		<result property="readCount" column="BOARD_READ_COUNT"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="memberFn" column="MEMBER_FN"/>
		<result property="professionNo" column="PROFESSION_NO"/>
		<result property="professionName" column="PROFESSION_NM"/>
		<result property="statusCode" column="BOARD_STATUS_CD"/>
		<result property="boardCategoryCode" column="BOARD_CATEGORY_CD"/>
		<result property="boardCategoryName" column="BOARD_CATEGORY_NM"/>
		<result property="worryCategoryCode" column="WORRY_CATEGORY_CD"/>
		<result property="worryCategoryName" column="WORRY_CATEGORY_NM"/>
		
		<result property="replyCount" column="REPLY_COUNT"/>
		<result property="memberImage" column="MEMBER_IMAGE"/>
		<result property="profrssionImage" column="PROFESSION_IMAGE"/>
		
		<result property="likeCount" column="L_COUNT"/>
		<result property="cheerCount" column="C_COUNT"/>
		<result property="sadCount" column="SA_COUNT"/>
		<result property="angryCount" column="A_COUNT"/>
		<result property="surpriseCount" column="SU_COUNT"/>

		<collection property="imgList" column="BOARD_NO"
					javaType="java.util.ArrayList" ofType="Image" select="selectBoardImageList"/>
		<collection property="emList" column="BOARD_NO"
					javaType="java.util.ArrayList" ofType="Empathy" select="selectEmpathyList"/>
	</resultMap>

	<resultMap type="Image" id="image_rm">
		<id property="imageNo" column="IMAGE_NO"/>
		<result property="imagePath" column="IMAGE_PATH"/>
		<result property="imageName" column="IMAGE_NM"/>
		<result property="imageOriginal" column="IMAGE_ORIGINAL"/>
		<result property="imageLevel" column="IMAGE_LEVEL"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="boardNo" column="PROFESSION_NO"/>
		<result property="professionNo" column="BOARD_NO"/>
	</resultMap>


    <resultMap type="Empathy" id="empathy_rm">
    	<result property="memberNo" column="MEMBER_NO"/>
    	<result property="boardNo" column="BOARD_NO"/>
    	<result property="empathyStatusCode" column="EMPATHY_STATUS_CD"/>
    </resultMap>

		<!-- 게시판 이미지 조회-->
	<select id="selectBoardImageList" resultMap="image_rm">
		SELECT * FROM IMAGE
		WHERE BOARD_NO = #{boardNo}
		ORDER BY IMAGE_LEVEL
	</select>


	<!-- 게시판 이미지 삽입 -->
   <insert id="insertImgList" parameterType="list">
   		INSERT INTO IMAGE
   		SELECT SEQ_IMAGE_NO.NEXTVAL, A.* FROM
		   <foreach collection="list" item="img" open="(" close=") A" separator=" UNION ALL ">
				SELECT #{img.imagePath} IMAGE_PATH,
					 #{img.imageName} IMAGE_NM,
					 #{img.imageOriginal} IMAGE_ORIGINAL,
					 #{img.imageLevel} IMAGE_LEVEL,
					 #{img.boardNo} BOARD_NO
				FROM DUAL
		   </foreach>
   </insert>


	<!-- 자유게시판 조회-->
	<select id="selectBoardList" resultMap="board_rm">
		SELECT * FROM BOARD WHERE BOARD_CATEGORY_CD = 101 AND BOARD_STATUS_CD = 201
	</select>
	
	    	
	<!-- 공감조회 -->
	<select id="selectEmpathyList" resultMap="empathy_rm">
		SELECT EMPATHY_STATUS_CD, COUNT(MEMBER_NO) FROM EMPATHY
		WHERE BOARD_NO = #{boardNo} GROUP BY EMPATHY_STATUS_CD
	</select>
    
	
	<!-- 자유게시판 게시글 작성 -->
	<insert id="insertFreeboard"  useGeneratedKeys="true" parameterType="Board">
		
	    <selectKey order="BEFORE" resultType="_int" keyProperty="boardNo">
	         SELECT SEQ_BOARD_NO.NEXTVAL FROM DUAL
	    </selectKey>
	    
		INSERT INTO BOARD 
		VALUES(BOARD_NO, NULL, #{boardContent}, DEFAULT, NULL, 0, 
				#{replyCheckCode},#{scrapCheckCode},101,#{memberNo},
				DEFAULT,DEFAULT,#{empathyCheckCode},#{anonCheckCode},NULL)
	</insert>
	
	<!-- 게시글 상세조회 -->
	<select id="selectBoard" resultMap="board_rm">

	</select>
	
	<update id="increaseReadCount">
		UPDATE BOARD SET 
		BOARD_READ_COUNT = BOARD_READ_COUNT+1 
		WHERE BOARD_NO = #{boardNo}
	</update>

	<!-- 작성 날짜 역순 / 최신 순 -->
	<select id="myBoardList" resultMap="board_rm" >
		SELECT MEMBER_NO, BOARD_NO, BOARD_TITLE,
			   TO_CHAR(BOARD_CREATE_DT, 'YYYY-MM-DD') "BOARD_CREATE_DT",
			   BOARD_CATEGORY_NM, BOARD_READ_COUNT
		FROM BOARD
				 JOIN MEMBER USING (MEMBER_NO)
				 JOIN BOARD_CATEGORY USING (BOARD_CATEGORY_CD)
		WHERE MEMBER_NO = #{memberNo}
		  AND BOARD_STATUS_CD = 201
		  AND STATUS_CD = 0
		ORDER BY BOARD_CREATE_DT DESC
	</select>

</mapper>
