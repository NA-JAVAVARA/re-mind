<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

    <resultMap id="member_rm" type="Member">
        <id property="memberNo" column="MEMBER_NO"/>
        <result property="memberId" column="MEMBER_ID"/>
        <result property="memberPw" column="MEMBER_PW"/>
        <result property="memberName" column="MEMBER_NM"/>
        <result property="memberAddress" column="MEMBER_ADDR"/>
        <result property="memberFName" column="MEMBER_FN"/>
        <result property="memberPhone" column="MEMBER_PHONE"/>
        <result property="memberGender" column="MEMBER_GENDER"/>
        <result property="memberEnrollDate" column="MEMBER_ENROLL_DT"/>
        <result property="statusCode" column="STATUS_CD"/>
    </resultMap>

    <resultMap id="social_rm" type="Naver">
        <id property="memberSocialNo" column="MEMBER_SOCIAL_NO"/>
        <result property="memberSocialToken" column="MEMBER_SOCIAL_TOKEN"/>
        <result property="memberNo" column="MEMBER_NO"/>
        <result property="socialType" column="SOCIAL_TYPE"/>
    </resultMap>

    <select id="emailLogin" resultMap="member_rm">
        SELECT * FROM MEMBER
        WHERE MEMBER_ID = #{memberId}
        AND STATUS_CD = 0
        AND MEMBER_TYPE = 'EMAIL'
    </select>
    
     <!-- 아이디 중복 검사 -->
	 <select id="idDupCheck"  resultType="_int" >
	 SELECT COUNT(*) FROM MEMBER
	 WHERE MEMBER_ID = #{inputId}
	 AND STATUS_CD != 1
	 </select>
	 
	 <!-- 닉네임 중복 검사 -->
	 <select id="nickNmDupCheck"  resultType="_int" >
	 SELECT COUNT(*) FROM MEMBER
	 WHERE MEMBER_FN = #{inputNickNm}
	 AND STATUS_CD != 1
	 </select>

    <select id="socialCheck" resultMap="member_rm">
        SELECT * FROM MEMBER WHERE MEMBER_PHONE = #{memberPhone}
    </select>

    <insert id="socialSignUp" useGeneratedKeys="true">
        <selectKey order="BEFORE" resultType="_int" keyProperty="memberNo">
            SELECT SEQ_MEMBER_NO.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO MEMBER VALUES(
        #{memberNo}, #{memberId}, NULL, #{memberName}, NULL, #{memberFName}, #{memberPhone}, #{memberGender}, DEFAULT, DEFAULT)
    </insert>

    <insert id="insertToken">
        INSERT INTO MEMBER_SOCIAL VALUES(
        SEQ_MEMBER_SOCIAL_NO.NEXTVAL, #{memberSocialToken}, #{memberNo}, #{socialType})
    </insert>


</mapper>
